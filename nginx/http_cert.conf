# O padrão é apenas um worker
worker_processes 4;

events {
    # O padrão é 1024 conexões por worker
    worker_connections  2048;
}

http {
    # Não enviar informações do servidor
    server_tokens   off;

    # Adicionamos no header algumas proteções
    # https://www.humankode.com/ssl/how-to-set-up-free-ssl-certificates-from-lets-encrypt-using-docker-and-nginx
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;

    # Definir charset comum aos brasileiros
    charset utf-8;

    # Impedir arquivos muito grandes
    client_max_body_size    75M;

    # Servidor apenas para adquirir o certificado
    server {
        # Porta do servidor na rede do servidor do docker (irá ouvir pedidos na
        # rede externa, já que o docker abre 80 para o mundo através da máquina)
        listen servidor:80;
        # Para IPv6:
        listen [::]:80;

        server_name www.caco.ic.unicamp.br caco.ic.unicamp.br;

        # .well-known/acme-challenge será usado por Let's Encrypt para
        # certificar de que estamos no controle do domínio
        location ^~ /.well-known {
            allow all;
            root /data/letsencrypt/;
        }
    }
}
